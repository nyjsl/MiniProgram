{"code":"!function(t){var e={};function n(o){if(e[o])return e[o].exports;var s=e[o]={i:o,l:!1,exports:{}};return t[o].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){\"undefined\"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&\"object\"===typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,\"default\",{enumerable:!0,value:t}),2&e&&\"string\"!=typeof t)for(var s in t)n.d(o,s,function(e){return t[e]}.bind(null,s));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,\"a\",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p=\"/\",n(n.s=0)}([function(t,e,n){t.exports=n(1)},function(t,e,n){\"use strict\";if(!self.__appxInited){var o=function(){n(2),n(3),n(4),n(5)};self.__appxInited=1,n(6),n(8);var s=self.AFAppX;self.getCurrentPages=s.getCurrentPages,self.getApp=s.getApp,self.Page=s.Page,self.App=s.App,self.my=s.bridge||s.abridge,self.abridge=self.my,self.Component=s.WorkerComponent||function(){},self.$global=s.$global,self.bootstrapApp?self.bootstrapApp({success:o}):o()}},function(t,e,n){\"use strict\";App({todos:[{text:\"Learning Javascript\",completed:!0},{text:\"Learning ES2016\",completed:!0},{text:\"Learning \\u652f\\u4ed8\\u5b9d\\u5c0f\\u7a0b\\u5e8f\",completed:!1}],userInfo:null})},function(t,e,n){\"use strict\";$global.currentComponentConfig={is:\"/components/add-button/add-button\",usingComponents:{}},Component({props:{text:\"Button\",onClickMe:function(){}},methods:{onClickMe:function(){this.props.onClickMe()}}})},function(t,e,n){\"use strict\";$global.currentPageConfig={pagePath:\"pages/todos/todos\",usingComponents:{\"add-button\":\"/components/add-button/add-button\"}};getApp();Page({data:{user:{},todos:[]},onLoad:function(){var t=this;basement.user.getInfo().then(function(e){e.success&&t.setData({user:e.result})}).catch(console.error)},onShow:function(){this.loadTodoList()},onTodoChanged:function(t){var e=this;if(!this.deleting){var n=t.detail.value,o=null,s=!0,i=!1,c=void 0;try{for(var a,r=this.data.todos[Symbol.iterator]();!(s=(a=r.next()).done);s=!0){var u=a.value;u.completed&&!n.includes(u._id)&&(o={_id:u._id,completed:!1}),!u.completed&&n.includes(u._id)&&(o={_id:u._id,completed:!0})}}catch(t){i=!0,c=t}finally{try{!s&&r.return&&r.return()}finally{if(i)throw c}}o&&this.changeComplate(o._id,o.completed).then(function(t){t.success&&e.loadTodoList()})}},deleteIcon:function(t){var e=this;this.deleting=!0;var n=t.currentTarget.dataset.id;this.deleteById(n).then(function(t){t.success&&e.loadTodoList()}),setTimeout(function(){e.deleting=!1},100)},addTodo:function(){my.navigateTo({url:\"../add-todo/add-todo\"})},loadTodoList:function(){var t=this;basement.db.collection(\"todos\").find({userId:this.data.user.userId},{sort:{createTime:-1}}).then(function(e){var n=e.result;t.setData({todos:n}),my.reportAnalytics(\"miniDemo\",{demoName:\"todo-basement\",res:n})}).catch(console.error)},deleteById:function(t){var e=this;return new Promise(function(n,o){my.confirm({title:\"\\u5220\\u9664 todo\",content:\"\\u662f\\u5426\\u786e\\u8ba4\\u5220\\u9664?\",confirmButtonText:\"\\u5220\\u9664\",cancelButtonText:\"\\u53d6\\u6d88\",success:function(s){s.confirm&&basement.db.collection(\"todos\").deleteOne({_id:t,userId:e.data.user.userId}).then(function(){n({success:!0})}).catch(function(t){console.error(t),o({success:!1})})}})})},changeComplate:function(t,e){return new Promise(function(n,o){basement.db.collection(\"todos\").updateOne({_id:t},{$set:{completed:e,completeTime:!!e&&new Date}}).then(function(){n({success:!0})}).catch(function(t){console.error(t),o({success:!1})})})}})},function(t,e,n){\"use strict\";$global.currentPageConfig={pagePath:\"pages/add-todo/add-todo\",usingComponents:{\"add-button\":\"/components/add-button/add-button\"}};getApp();Page({data:{inputValue:\"\",iconUrl:\"\"},onBlur:function(t){this.setData({inputValue:t.detail.value})},add:function(){\"\"==this.data.inputValue?my.alert({title:\"\\u6dfb\\u52a0\\u5931\\u8d25\",content:\"\\u8bf7\\u586b\\u5199\\u4efb\\u52a1\\u540d\\u79f0\\u3002\",buttonText:\"\\u6211\\u77e5\\u9053\\u4e86\"}):this.addTodo().then(function(t){t.success?my.navigateBack():my.showToast({content:\"\\u8bf7\\u6c42\\u5931\\u8d25\\uff0c\\u8bf7\\u91cd\\u8bd5\"})})},uploadImg:function(){var t=this;my.chooseImage({chooseImage:1,success:function(e){var n={filePath:e.apFilePaths[0],headers:{contentDisposition:\"attachment\"}};basement.file.uploadFile(n).then(function(e){t.setData({iconUrl:e.fileUrl})}).catch(console.error)}})},addTodo:function(){var t=this;return new Promise(function(e,n){basement.user.getInfo().then(function(o){if(o.success){var s=o.result;basement.db.collection(\"todos\").insertOne({text:t.data.inputValue,iconUrl:!!t.data.iconUrl&&t.data.iconUrl,userId:s.userId,completed:!1,createTime:new Date,completeTime:!1}).then(function(){e({success:!0})}).catch(function(t){console.error(t),n({success:!1})})}}).catch(function(t){console.error(t),n({success:!1})})})}})},function(t,e,n){\"use strict\";(function(t){(\"undefined\"!==typeof t?t:self).appXAppJson={app:{$homepage:\"pages/todos/todos\"}}}).call(this,n(7))},function(t,e){var n;n=function(){return this}();try{n=n||new Function(\"return this\")()}catch(t){\"object\"===typeof window&&(n=window)}t.exports=n},function(t,e,n){\"use strict\";self.Map&&self.Set||importScripts(\"https://gw.alipayobjects.com/as/g/appx_release/deps/1.0.0/es6-set-map.js\"),importScripts(\"https://appx/af-appx.worker.min.js\")}]);","extractedComments":[]}